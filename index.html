<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<meta name="description" content="تابع غيابك الدراسي بكل أناقة وسهولة. تصميم عصري، تحكم دقيق، وتجربة فريدة.">
	<meta name="theme-color" content="#0a0a0a">
	<title>حاسبة الغياب</title>

	<!-- PWA & Mobile App Settings (Simplified) -->
	<link rel="manifest" href="data:application/manifest+json,%7B%22name%22%3A%22%D8%AD%D8%A7%D8%B3%D8%A8%D8%A9%20%D8%A7%D9%84%D8%BA%D9%8A%D8%A7%D8%A8%22%2C%22short_name%22%3A%22%D8%AD%D8%A7%D8%B3%D8%A8%D8%A9%20%D8%A7%D9%84%D8%BA%D9%8A%D8%A7%D8%A8%22%2C%22description%22%3A%22%D8%AA%D8%A7%D8%A8%D8%B9%20%D8%BA%D9%8A%D8%A7%D8%A8%D9%83%20%D8%A7%D9%84%D8%AF%D8%B1%D8%A7%D8%B3%D9%8A%20%D8%A8%D9%83%D9%84%20%D8%A3%D9%86%D8%A7%D9%82%D8%A9%20%D9%88%D8%B3%D9%87%D9%88%D9%84%D8%A9.%22%2C%22start_url%22%3A%22.%22%2C%22display%22%3A%22standalone%22%2C%22background_color%22%3A%22%230a0a0a%22%2C%22theme_color%22%3A%22%230a0a0a%22%2C%22orientation%22%3A%22portrait-primary%22%2C%22icons%22%3A%5B%7B%22src%22%3A%22data%3Aimage/svg%2Bxml%3Bbase64%2CPHN2ZyB3aWR0aD0iNTEyIiBoZWlnaHQ9IjUxMiIgdmlld0JveD0iMCAwIDUxMiA1MTIiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI%2BPHJlY3Qgd2lkdGg9IjUxMiIgaGVpZ2h0PSI1MTIiIHJ4PSI5MCIgZmlsbD0iIzBhMGEwYSIvPjxnIHRyYW5zZm9ybT0idHJhbnNsYXRlKDY0IDApIj48cmVjdCB4PSI2NCIgeT0iNDgiIHdpZHRoPSIzODQiIGhlaWdodD0iNDE2IiByeD0iNDAiIGZpbGw9IiMyMjI1MmQiLz48cmVjdCB4PSI5NiIgeT0iODAiIHdpZHRoPSIzMjAiIGhlaWdodD0iOTYiIHJ4PSIyMCIgZmlsbD0iIzVlOWNmZiIvPjxnIGZpbGw9IiM0YjUwNWEiPjxjaXJjbGUgY3g9IjE1MCIgY3k9IjI0MCIgcj0iMzIiLz48Y2lyY2xlIGN4PSIyNTYiIGN5PSIyNDAiIHI9IjMyIi8%2BY2lyY2xlIGN4PSIzNjIiIGN5PSIyNDAiIHI9IjMyIi8%2BY2lyY2xlIGN4PSIxNTAiIGN5PSIzMzAiIHI9IjMyIi8%2BY2lyY2xlIGN4PSIyNTYiIGN5PSIzMzAiIHI9IjMyIi8%2BY2lyY2xlIGN4PSIzNjIiIGN5PSIzMzAiIHI9IjMyIi8%2BY2lyY2xlIGN4PSIxNTAiIGN5PSI0MjAiIHI9IjMyIi8%2BY2lyY2xlIGN4PSIyNTYiIGN5PSI0MjAiIHI9IjMyIi8%2BY2lyY2xlIGN4PSIzNjIiIGN5PSI0MjAiIHI9IjMyIi8%2BPC9nPjwvZz48L3N2Zz4%3D%22%2C%22sizes%22%3A%22192x192%20512x512%22%2C%22type%22%3A%22image/svg%2Bxml%22%7D%5D%7D">
	<link rel="apple-touch-icon" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNTEyIiBoZWlnaHQ9IjUxMiIgdmlld0JveD0iMCAwIDUxMiA1 tribulationsPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHJlY3Qgd2lkdGg9IjUxMiIgaGVpZ2h0PSI1MTIiIHJ4PSI5MCIgZmlsbD0iIzBhMGEwYSIvPjxnIHRyYW5zZm9ybT0idHJhbnNsYXRlKDY0IDApIj48cmVjdCB4PSI2NCIgeT0iNDgiIHdpZHRoPSIzODQiIGhlaWdodD0iNDE2IiByeD0iNDAiIGZpbGw9IiMyMjI1MmQiLz48cmVjdCB4PSI5NiIgeT0iODAiIHdpZHRoPSIzMjAiIGhlaWdodD0iOTYiIHJ4PSIyMCIgZmlsbD0iIzVlOWNmZiIvPjxnIGZpbGw9IiM0YjUwNWEiPjxjaXJjbGUgY3g9IjE1MCIgY3k9IjI0MCIgcj0iMzIiLz48Y2lyY2xlIGN4PSIyNTYiIGN5PSIyNDAiIHI9IjMyIi8%2BY2lyY2xlIGN4PSIzNjIiIGN5PSIyNDAiIHI9IjMyIi8%2BY2lyY2xlIGN4PSIxNTAiIGN5PSIzMzAiIHI9IjMyIi8%2BY2lyY2xlIGN4PSIyNTYiIGN5PSIzMzAiIHI9IjMyIi8%2BY2lyY2xlIGN4PSIzNjIiIGN5PSIzMzAiIHI9IjMyIi8%2BY2lyY2xlIGN4PSIxNTAiIGN5PSI0MjAiIHI9IjMyIi8%2BY2lyY2xlIGN4PSIyNTYiIGN5PSI0MjAiIHI9IjMyIi8%2BY2lyY2xlIGN4PSIzNjIiIGN5PSI0MjAiIHI9IjMyIi8%2BPC9nPjwvZz48L3N2Zz4=">
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
	<meta name="apple-mobile-web-app-title" content="حاسبة الغياب">

	<script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
	<script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
	<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
	<style>
		@import url("https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap");
		@import url("https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+Arabic:wght@400;700&display=swap");
		:root{--color-primary:#5e9cff;--color-primary-dark:#4b7dcc;--color-danger-red:#ff5252;--color-warning-gold:#ffc400;--color-bonus-green:#00e676;--color-save-green:#00c853;--color-bg:#0a0a0a;--color-card:rgba(20,20,22,0.75);--color-border:rgba(255,255,255,0.1);--color-text:#e0e0e0;--color-text-muted:#999;--font-body:"Cairo",sans-serif;--font-title:"IBM Plex Sans Arabic",sans-serif;--radius:16px;--transition:0.3s cubic-bezier(0.25,0.8,0.25,1);--transition-smooth:0.5s cubic-bezier(0.2,0.8,0.2,1);--rgb-primary:94,156,255;--rgb-warning:255,196,0;--rgb-danger:255,82,82}
		*{margin:0;padding:0;box-sizing:border-box}
		@keyframes gradient-animation{0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}
		@keyframes fadeInUp{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}
		@keyframes scaleIn{from{opacity:0;transform:scale(.95)}to{opacity:1;transform:scale(1)}}
		@keyframes glow-update{0%{box-shadow:0 0 0 0 rgba(var(--rgb-primary),0)}50%{box-shadow:0 0 20px 5px rgba(var(--rgb-primary),0.4)}100%{box-shadow:0 0 0 0 rgba(var(--rgb-primary),0)}}
		body{font-family:var(--font-body);background-color:var(--color-bg);color:var(--color-text);direction:rtl;overflow-x:hidden;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}
		.app{min-height:100vh;position:relative;padding:2rem 1rem;}
		.aurora-bg{position:fixed;top:0;left:0;width:100%;height:100%;overflow:hidden;z-index:-1;transition:all .5s ease}
		.aurora-dot{position:absolute;border-radius:50%;filter:blur(120px);opacity:.25;transition:background-color .5s ease}
		.aurora-dot-1{width:50vw;height:50vw;background-color:var(--color-primary);top:5%;left:0%;animation:move-aurora-1 25s infinite alternate ease-in-out}
		.aurora-dot-2{width:45vw;height:45vw;background-color:var(--color-primary-dark);bottom:10%;right:5%;animation:move-aurora-2 30s infinite alternate-reverse ease-in-out}
		@keyframes move-aurora-1{from{transform:translate(0,0) rotate(0deg) scale(1)}to{transform:translate(15vw,20vh) rotate(120deg) scale(1.2)}}
		@keyframes move-aurora-2{from{transform:translate(0,0) rotate(0deg) scale(1.2)}to{transform:translate(-10vw,-15vh) rotate(-150deg) scale(1)}}
		.container{width:100%;max-width:600px;z-index:1;display:flex;flex-direction:column;gap:1.5rem;margin:0 auto;position:relative}
		.header{text-align:center;animation:fadeInUp .8s var(--transition-smooth) both}
		.title{font-family:var(--font-title);font-weight:700;font-size:2.8rem;margin-bottom:.5rem;background:linear-gradient(90deg,var(--color-primary-dark),var(--color-primary));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-size:200% 200%;animation:gradient-animation 5s ease-in-out infinite}
		.subtitle{color:var(--color-text-muted);font-size:1rem;animation:fadeInUp .8s var(--transition-smooth) .2s both}
		.card{background:var(--color-card);border:1px solid var(--color-border);border-radius:var(--radius);padding:1.5rem;backdrop-filter:blur(16px);-webkit-backdrop-filter:blur(16px);transition:var(--transition);position:relative;animation:scaleIn .8s var(--transition-smooth) .4s both;box-shadow:0 10px 30px rgba(0,0,0,0.2),inset 0 1px 0 rgba(255,255,255,0.05), inset 0 -1px 0 rgba(0,0,0,0.2); border-image: linear-gradient(to top right, rgba(255,255,255,0.15), rgba(255,255,255,0.05)) 1;}
		.card.safe{--status-color:var(--color-primary);--rgb-status:var(--rgb-primary)}
		.card.warning{--status-color:var(--color-warning-gold);--rgb-status:var(--rgb-warning)}
		.card.danger{--status-color:var(--color-danger-red);--rgb-status:var(--rgb-danger)}
		.card-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:1.5rem;padding-bottom:1.5rem;border-bottom:1px solid var(--color-border)}
		.card-header h2{font-family:var(--font-title);font-weight:700;font-size:1.7rem;color:#fff;display:flex;align-items:center;gap:0.75rem;}
		.input-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:1.25rem;align-items:flex-end}
		.label-with-info{display:flex;justify-content:space-between;align-items:center;margin-bottom:.5rem}
		.input-group label{display:block;font-size:.9rem;color:var(--color-text-muted)}
		.input-group input,.input-group select{width:100%;background:rgba(0,0,0,0.3);border:1px solid var(--color-border);border-radius:8px;padding:.75rem;color:var(--color-text);font-family:var(--font-body);font-size:1rem;transition:var(--transition)}
		.input-group input:focus,.input-group select:focus{outline:none;border-color:var(--status-color,var(--color-primary));box-shadow:0 0 0 3px rgba(var(--rgb-status, var(--rgb-primary)), 0.4)}
		.absence-control{display:flex;align-items:center;background:rgba(0,0,0,0.3);border:1px solid var(--color-border);border-radius:8px;overflow:hidden}
		.absence-control input{flex-grow:1;border:none!important;background:transparent!important;text-align:center;box-shadow:none!important;padding:.75rem .25rem}
		.absence-control button{background:rgba(255,255,255,0.05);border:none;color:var(--color-text);font-size:1.5rem;cursor:pointer;padding:0 1rem;transition:all .2s ease;line-height:1;display:flex;align-items:center;height:100%;user-select:none}
		.absence-control button:first-of-type{border-left:1px solid var(--color-border)}
		.absence-control button:last-of-type{border-right:1px solid var(--color-border)}
		.absence-control button:hover{background:rgba(var(--rgb-primary),0.2);color:var(--color-primary);transform:scale(1.1)}
		.absence-control button:active{transform:scale(.95)}
		.absence-control input::-webkit-inner-spin-button,.absence-control input::-webkit-outer-spin-button{-webkit-appearance:none;margin:0}
		.absence-control input{-moz-appearance:textfield}
		.divider{height:1px;background:var(--color-border);margin:1.5rem 0}
        .collapsible-header{display:flex;justify-content:space-between;align-items:center;cursor:pointer;padding:.5rem 0}
		.collapsible-title{font-family:var(--font-title);font-size:1.2rem;color:#fff;margin:0; display: flex; align-items: center; gap: 0.5rem;}
		.collapsible-toggle-btn{background:none;border:none;color:var(--color-text-muted);font-size:1.5rem;transition:transform .4s ease;display:flex;align-items:center}
		.collapsible-toggle-btn.expanded{transform:rotate(90deg)}
		.collapsible-content{display:grid;grid-template-rows:0fr;transition:grid-template-rows .4s ease}
		.collapsible-content.visible{grid-template-rows:1fr}
		.collapsible-content > div{overflow:hidden}
		.save-button{width:100%;padding:.8rem;font-family:var(--font-body);font-size:1.1rem;font-weight:600;border:none;border-radius:8px;cursor:pointer;background:linear-gradient(90deg,var(--color-primary-dark),var(--color-primary));color:#fff;transition:all .2s ease-in-out;display:flex;justify-content:center;align-items:center;gap:.5rem;user-select:none}
		.save-button:hover{transform:translateY(-3px);box-shadow:0 4px 15px rgba(var(--rgb-primary),0.25); filter: brightness(1.1);}
		.save-button:active{transform:translateY(-1px) scale(.98)}
		.course-list-header{display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:1rem;margin-bottom:1.5rem;padding-bottom:1.5rem;border-bottom:1px solid var(--color-border)}
		.list-controls{display:flex;gap:.75rem;align-items:center}
		.list-controls .control-btn{position:relative;background:rgba(0,0,0,0.3);border:1px solid var(--color-border);color:var(--color-text);border-radius:8px;cursor:pointer;transition:var(--transition);display:flex;align-items:center;font-size:1rem;gap:.5rem;padding:0 .5rem 0 1rem}
		.list-controls .control-btn:hover{border-color:var(--color-primary);color:var(--color-text)}
		.list-controls .control-btn select{color:var(--color-text);background:transparent;border:none;outline:none;padding:.5rem 2rem .5rem .5rem;font-family:var(--font-body);font-size:1rem;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer}
		.list-controls .control-btn .sort-icon{position:absolute;right:1rem;pointer-events:none}
		.course-list{display:flex;flex-direction:column;gap:1rem}
		.course-item{display:grid;grid-template-columns:1fr auto;grid-template-rows:auto auto auto;gap:.25rem 1rem;padding:1rem;background:rgba(0,0,0,0.2);border-radius:12px;border-right:4px solid var(--status-color,var(--color-primary));transition:all .4s ease;opacity:0;animation:fadeInUp .5s ease both}
		.course-item.updated{animation:glow-update 1.5s ease-out,fadeInUp .5s ease both}
		.course-item.safe{--status-color:var(--color-primary)}
		.course-item.warning{--status-color:var(--color-warning-gold)}
		.course-item.danger{--status-color:var(--color-danger-red)}
		.course-item:hover{transform:translateX(5px);background:rgba(255,255,255,0.05)}
		.course-info h3{font-family:var(--font-title);font-size:1.3rem;font-weight:400;color:#fff}
		.course-info p{color:var(--color-text-muted);font-size:0.8rem;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
		.course-meta{grid-column:1/3;font-size:.8rem;color:var(--color-text-muted);margin-top:.5rem;display:flex;justify-content:space-between;align-items:center}
		.course-progress{grid-column:1/3;width:100%;height:6px;background:var(--color-border);border-radius:3px;margin-top:.5rem}
		.course-progress-bar{height:100%;background:var(--status-color,var(--color-primary));border-radius:3px;transition:var(--transition)}
		.course-actions{grid-column:2/3;grid-row:1/2;display:flex;gap:.5rem}
		.course-actions button{background:none;border:none;color:var(--color-text-muted);font-size:1.2rem;cursor:pointer;transition:var(--transition);display:flex;align-items:center;justify-content:center;padding:0.25rem}
		.course-actions button:hover{color:#fff;transform:scale(1.1)}
		.course-actions button[title=تعديل]:hover{color:var(--color-primary)}
		.course-actions button[title=حذف]:hover{color:var(--color-danger-red)}
		.quick-add-controls { display: flex; gap: 0.5rem; }
        .quick-add-btn { background-color: rgba(255, 255, 255, 0.05); border: 1px solid var(--color-border); color: var(--color-text-muted); font-size: 0.8rem; font-weight: bold; cursor: pointer; border-radius: 6px; padding: 0.2rem 0.6rem; transition: all 0.2s ease; user-select: none; }
        .quick-add-btn:hover { background-color: rgba(var(--rgb-primary), 0.2); border-color: var(--color-primary); color: var(--color-primary); transform: scale(1.05); }
        .quick-add-btn:active { transform: scale(0.95); }
		.footer{text-align:center;color:var(--color-text-muted);font-size:.9rem;display:flex;justify-content:space-between;align-items:center;padding-top:1rem;border-top:1px solid var(--color-border);animation:fadeInUp .8s var(--transition-smooth) .8s both}
		.footer-controls{display:flex;align-items:center;gap:1rem}
		.theme-picker{display:flex;gap:.5rem;align-items:center;}
		.theme-dot{width:20px;height:20px;border-radius:50%;cursor:pointer;transition:transform .2s ease, border-color .2s ease;border:2px solid transparent}
		.theme-dot:hover{transform:scale(1.2)}
		.theme-dot.active{border-color:#fff}
        .color-picker-label { font-size: 1.2rem; line-height: 1; color: var(--color-text-muted); cursor: pointer; transition: all .2s ease; display: flex; align-items: center; justify-content: center; width: 24px; height: 24px; border-radius: 50%; border: 2px solid transparent; margin-right: 0.25rem; user-select: none;}
        .color-picker-label:hover { transform: scale(1.2); }
        .color-picker-label.active { text-shadow: 0 0 8px var(--color-primary); transform: scale(1.15); }
        .color-picker-input { visibility: hidden; width: 0; height: 0; position: absolute; }
		.footer-link{color:var(--color-text-muted);transition:var(--transition);display:inline-flex;align-items:center;gap:0.3rem;text-decoration:none}
		.footer-link:hover{color:#fff;transform:scale(1.05)}
		.footer-link svg{font-size:1.4rem}
		.reset-all-btn, .clear-button {background:none;border:none;color:var(--color-text-muted);font-size:1.5rem;cursor:pointer;transition:var(--transition);display:flex;align-items:center;justify-content:center}
        .clear-button:hover{color:var(--color-primary);transform:rotate(90deg) scale(1.1)}
		.reset-all-btn:hover{color:var(--color-danger-red);transform:rotate(90deg) scale(1.1)}
		.select-wrapper{position:relative}
		.select-wrapper::after{content:"";position:absolute;top:50%;left:15px;width:0;height:0;border:6px solid transparent;border-top-color:var(--color-text-muted);transform:translateY(-50%);pointer-events:none;transition:var(--transition)}
		.select-wrapper:hover::after{border-top-color:var(--color-text)}
		.input-group select{padding-left:2.5rem;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer}
		.input-group option{background:var(--color-primary-dark);color:var(--color-text)}
		.bonus-toggle-container{padding:1rem 0;margin-bottom:.5rem;display:flex;justify-content:center}
		.toggle-label-wrapper{display:inline-flex;align-items:center;cursor:pointer;color:var(--color-text)}
		.toggle-label-wrapper input[type=checkbox]{display:none}
		.toggle-switch{position:relative;width:50px;height:26px;background-color:var(--color-border);border-radius:13px;transition:background-color .2s ease-in-out}
		.toggle-switch::before{content:"";position:absolute;top:3px;left:4px;width:20px;height:20px;background-color:#fff;border-radius:50%;transition:transform .2s ease-in-out}
		.toggle-label-wrapper input:checked+.toggle-switch{background-color:var(--color-primary)}
		.toggle-label-wrapper input:checked+.toggle-switch::before{transform:translateX(24px)}
		.toggle-text{margin-right:12px;font-weight:600}
		.info-tooltip-wrapper{position:relative;display:flex;align-items:center;color:var(--color-text-muted);cursor:help;margin-right:0.5rem;}
		.info-tooltip-wrapper .info-tooltip{visibility:hidden;opacity:0;width:250px;background-color:var(--color-primary-dark);color:#fff;text-align:right;border-radius:8px;padding:.75rem;position:absolute;z-index:10;bottom:125%;left:0;transform:none;transition:opacity .3s;font-size:.8rem;box-shadow:0 4px 15px rgba(0,0,0,0.3);line-height:1.6;}
		.info-tooltip-wrapper .info-tooltip::after{content:"";position:absolute;top:100%;left:10px;margin-left:0;border-width:5px;border-style:solid;border-color:var(--color-primary-dark) transparent transparent transparent;}
		.info-tooltip-wrapper:hover .info-tooltip{visibility:visible;opacity:1}
		.result-section{display:flex;align-items:center;gap:1.5rem;margin-bottom:1.5rem;padding:1.5rem;border-radius:var(--radius);animation:fadeInUp .6s ease both;transition:background .4s ease;background:radial-gradient(circle,rgba(var(--rgb-status,var(--rgb-primary)),0.1) 0%,transparent 70%),rgba(0,0,0,0.2)}
		.chart-container{position:relative;min-width:120px;height:120px}
		.donut-chart{width:100%;height:100%;transform:rotate(-90deg)}
		.donut-chart-bg{fill:none;stroke:var(--color-border);stroke-width:10}
		.donut-chart-fg{fill:none;stroke-width:10;stroke-linecap:round;transition:stroke-dashoffset .8s var(--transition-smooth),stroke .4s ease}
		.donut-chart-fg.safe{stroke:var(--color-primary)}
		.donut-chart-fg.warning{stroke:var(--color-warning-gold)}
		.donut-chart-fg.danger{stroke:var(--color-danger-red)}
		.chart-info{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);text-align:center;width:100%;display:flex;flex-direction:column;justify-content:center;align-items:center}
		.chart-info span{font-family:var(--font-title);font-weight:700;font-size:2rem;color:#fff;line-height:1.1}
		.chart-info p{font-size:.8rem;color:var(--color-text-muted);margin-top:0.25rem}
		.result-details{flex:1}
		.detail-item{display:flex;justify-content:space-between;align-items:baseline;padding:.5rem 0;font-size:.9rem}
		.detail-item strong{font-size:1.1rem;color:#fff}
		.predictive-text{margin-top:1rem;padding:.75rem;background:rgba(0,0,0,0.3);border-radius:8px;text-align:center;font-weight:600;border-right:3px solid var(--status-color,var(--color-border));color:var(--status-color,var(--color-text));transition:all var(--transition)}
		.denial-message{display:flex;align-items:center;gap:.8rem;margin-top:1rem;background:linear-gradient(90deg,rgba(var(--rgb-danger),0.2),rgba(var(--rgb-danger),0.05));padding:.75rem 1rem;border-radius:var(--radius);border-right:4px solid var(--color-danger-red)}
		.denial-icon{color:var(--color-danger-red);font-size:2rem;flex-shrink:0}
		.denial-text-content{flex:1}
		.denial-title{font-weight:700;color:#fff;font-size:1.1rem}
		.denial-subtitle{font-size:.9rem;color:var(--color-text-muted);margin-top:.25rem}
		.bonus-box{display:flex;align-items:center;gap:.8rem;margin-top:1rem;background:linear-gradient(90deg,rgba(0,230,118,0.15),rgba(0,230,118,0.05));padding:.75rem 1rem;border-radius:var(--radius);border:1px solid rgba(0,230,118,0.3);box-shadow:0 0 15px rgba(0,230,118,0.1)}
		.bonus-icon{color:var(--color-bonus-green);font-size:1.6rem;flex-shrink:0}
		.bonus-text-content{flex:1}
		.bonus-title{font-weight:700;color:#fff;font-size:.9rem}
		.bonus-subtitle{font-size:.8rem;color:var(--color-text-muted);margin-top:.25rem}
		.empty-list-message{text-align:center;padding:2rem;color:var(--color-text-muted);border:2px dashed var(--color-border);border-radius:var(--radius);display:flex;flex-direction:column;align-items:center;gap:1rem}
		.empty-list-message svg{font-size:3rem;color:var(--color-primary)}
        .settings-container { padding-top: 1rem; }
        .settings-item { display: flex; justify-content: space-between; align-items: center; }
        .settings-item h3 { font-family: var(--font-body); font-weight: 600; font-size: 1rem; color: var(--color-text); }
        .stepper-control { display: flex; align-items: center; background: rgba(0,0,0,0.3); border: 1px solid var(--color-border); border-radius: 8px; overflow: hidden; }
        .stepper-control .stepper-value { font-family: var(--font-title); font-weight: 700; font-size: 1.4rem; color: #fff; padding: 0.3rem 1.2rem; min-width: 50px; text-align: center; user-select: none; }
        .stepper-control button { background: rgba(255,255,255,0.05); border: none; color: var(--color-text); font-size: 1.5rem; cursor: pointer; padding: 0 1rem; transition: all .2s ease; line-height: 1; display: flex; align-items: center; height: 100%; user-select: none; }
        .stepper-control button:first-of-type { border-left: 1px solid var(--color-border); }
        .stepper-control button:last-of-type { border-right: 1px solid var(--color-border); }
        .stepper-control button:hover:not(:disabled) { background: rgba(var(--rgb-primary),0.2); color: var(--color-primary); transform: scale(1.1); }
        .stepper-control button:disabled { opacity: 0.3; cursor: not-allowed; transform: none !important; background: transparent !important; color: var(--color-text-muted) !important; }
		.swal2-popup{background:var(--color-card)!important;color:var(--color-text)!important;border-radius:var(--radius)!important;border:1px solid var(--color-border)!important}
		.swal2-title{color:var(--color-text)!important; font-family: var(--font-title) !important;}
		.swal2-html-container{color:var(--color-text-muted)!important}
		.swal2-confirm{background:var(--color-primary)!important;border-radius:8px!important;padding:.6rem 1.5rem!important;font-family:var(--font-body)!important}
		.swal2-confirm:focus{box-shadow:0 0 0 3px rgba(var(--rgb-primary),0.5)!important}
		.swal2-cancel{background:rgba(255,255,255,0.1)!important;color:var(--color-text)!important;border-radius:8px!important;padding:.6rem 1.5rem!important;font-family:var(--font-body)!important}
		.swal2-toast { border-radius: 12px !important; border: 1px solid var(--color-border) !important; padding: 1rem !important; }
		.swal2-toast .swal2-title { font-size: 1rem !important; }
		
		@media(max-width:600px){
			.app { padding: 1.5rem 1rem; }
			.card { padding: 1.25rem; }
			.title { font-size: 2.2rem; }
			.card-header { padding-bottom: 1rem; margin-bottom: 1rem; }
			.card-header h2 { font-size: 1.5rem; }
			.input-grid { grid-template-columns: 1fr; gap: 1rem; }
			.result-section { flex-direction: column; padding: 1rem; }
			.chart-container { width: 100px; height: 100px; }
			.chart-info span { font-size: 1.6rem; }
			.course-list-header { flex-direction: column; align-items: stretch; }
			.course-info h3 { font-size: 1.15rem; }
			.footer { flex-direction: column; gap: 1.5rem; }
		}
	</style>
</head>
<body>
	<noscript>You need to enable JavaScript to run this app.</noscript>
	<div id="root"></div>
	<script type="text/babel">
		const { useState, useEffect, useMemo, useCallback, StrictMode } = React;
		
		const SvgIcon = ({ d, viewBox = "0 0 24 24", ...props }) => (
			<svg stroke="currentColor" fill="currentColor" strokeWidth="0" viewBox={viewBox} height="1em" width="1em" xmlns="http://www.w3.org/2000/svg" {...props}>
				<path d={d}></path>
			</svg>
		);

		const Icons = {
			ChevronRight: props => <SvgIcon d="M9 18L15 12 9 6" {...props} />,
			ChevronLeft: props => <SvgIcon d="M15 18L9 12 15 6" {...props} />,
			Plus: props => <SvgIcon d="M12 5V19M5 12H19" {...props} />,
			Edit2: props => <SvgIcon d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z" {...props} />,
			Trash: props => <SvgIcon d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z" {...props} />,
			Telegram: props => <SvgIcon d="M9.78 18.65l.28-4.23 7.68-6.92c.34-.31-.07-.46-.52-.19L7.74 13.3 1.62 11.22c-.72-.24-.72-1.16 0-1.41l18.26-6.91c.63-.24 1.22.23 1.01.89L17.43 18.4c-.2 1.39-1.53 1.76-2.53.94l-4.26-3.51-2.86 2.72a.5.5 0 0 1-.88-.38v-4.48z" {...props} />,
			Check: props => <SvgIcon d="M20 6L9 17 4 12" {...props} />,
			Save: props => <SvgIcon d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2zM17 21v-8H7v8M7 3v5h8" {...props} />,
			Shield: props => <SvgIcon d="M466.5 83.7l-192-80a48.15 48.15 0 00-36.9 0l-192 80C27.7 93.7 16 115.8 16 140.1V284c0 131.2 133.5 215.3 216.2 240a48.1 48.1 0 0027.6 0C362.5 499.3 496 415.2 496 284V140.1c0-24.3-11.7-46.4-29.5-56.4z" viewBox="0 0 512 512" {...props} />,
			Lightbulb: props => <SvgIcon d="M12 2C8.13 2 5 5.13 5 9c0 2.38 1.19 4.47 3 5.74V17c0 .55.45 1 1 1h6c.55 0 1-.45 1-1v-2.26c1.81-1.27 3-3.36 3-5.74 0-3.87-3.13-7-7-7z" {...props} />,
			Sort: props => <SvgIcon d="M3 18h6v-2H3v2zM3 6v2h18V6H3zm0 7h12v-2H3v2z" {...props} />,
			ClipboardList: props => <SvgIcon d="M19 3h-4.18C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm2 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z" {...props} />,
			AlertTriangle: props => <SvgIcon d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0zM12 9v4M12 17h.01" {...props} />,
            Restart: props => <SvgIcon d="M12 5V2L8 6l4 4V7c3.31 0 6 2.69 6 6s-2.69 6-6 6-6-2.69-6-6H4c0 4.42 3.58 8 8 8s8-3.58 8-8-3.58-8-8-8z" {...props} />,
            Sliders: props => <SvgIcon d="M4 21v-7M4 10V3M12 21v-9M12 8V3M20 21v-5M20 12V3M2 14h4M10 8h4M18 16h4" {...props} />,
			PaintPaletteEmoji: props => <span {...props}>🎨</span>,
		};

        const CONSTANTS = { DENIAL_PERCENTAGE: 0.25, MIN_WEEKS: 8, MAX_WEEKS: 20 };
		const PRESET_THEMES = {
			blue: '#5e9cff',
			purple: '#a777ff',
			green: '#00e676',
		};

        const Toast = Swal.mixin({
            toast: true, position: 'bottom', showConfirmButton: false, timer: 3000, timerProgressBar: true,
            didOpen: (toast) => { toast.addEventListener('mouseenter', Swal.stopTimer); toast.addEventListener('mouseleave', Swal.resumeTimer); }
        });
		
		const useLocalStorage = (key, defaultValue) => {
			const [value, setValue] = useState(() => {
				try { const saved = localStorage.getItem(key); return saved ? JSON.parse(saved) : defaultValue; }
				catch (error) { console.error(error); return defaultValue; }
			});
			useEffect(() => { localStorage.setItem(key, JSON.stringify(value)); }, [key, value]);
			return [value, setValue];
		};

        function hexToRgb(hex) {
            let result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
            return result ? `${parseInt(result[1], 16)}, ${parseInt(result[2], 16)}, ${parseInt(result[3], 16)}` : null;
        }

        function adjustColorBrightness(hex, percent) {
            let r = parseInt(hex.slice(1, 3), 16), g = parseInt(hex.slice(3, 5), 16), b = parseInt(hex.slice(5, 7), 16);
            const p = percent / 100;
            r = Math.min(255, Math.max(0, Math.round(r * (1 + p))));
            g = Math.min(255, Math.max(0, Math.round(g * (1 + p))));
            b = Math.min(255, Math.max(0, Math.round(b * (1 + p))));
            return `#${(r).toString(16).padStart(2, '0')}${(g).toString(16).padStart(2, '0')}${(b).toString(16).padStart(2, '0')}`;
        }

		const formatHoursText = (hours) => {
			if (hours < 0) hours = 0; if (hours === 1) return "ساعة"; if (hours === 2) return "ساعتين";
			if (hours >= 3 && hours <= 10) return `${hours} ساعات`; return `${hours} ساعة`;
		};
		
		function formatRelativeTime(timestamp) {
			const now = new Date(), past = new Date(timestamp), diff = (now - past) / 1000;
			if (diff < 60) return `قبل ${Math.round(diff)} ثوان`; const mins = Math.round(diff / 60);
			if (mins < 60) return `قبل ${mins} دقيقة`; const hours = Math.round(diff / 3600);
			if (hours < 24) return `قبل ${hours} ساعة`; const days = Math.round(diff / 86400);
			return days === 1 ? "بالأمس" : `قبل ${days} أيام`;
		}

		function getCourseStatus(course, semesterWeeks) {
            const total = semesterWeeks * course.lectureHours;
            const allowed = Math.floor(total * CONSTANTS.DENIAL_PERCENTAGE);
            const denial = allowed + 1;
            const remaining = denial - course.absenceHours;
            const isDenied = course.absenceHours >= denial;
            if (isDenied) return { name: 'danger', remaining, isDenied };
            if (remaining <= 2 && !isDenied) return { name: 'warning', remaining, isDenied };
            return { name: 'safe', remaining, isDenied };
        }
		
		function DonutChart({ percentage, status }) {
			const [animatedPercentage, setAnimatedPercentage] = useState(0);
			useEffect(() => { const animation = requestAnimationFrame(() => setAnimatedPercentage(percentage)); return () => cancelAnimationFrame(animation); }, [percentage]);
			const circumference = 2 * Math.PI * 45, offset = circumference - (animatedPercentage / 100) * circumference;
			return <svg className="donut-chart" viewBox="0 0 100 100"><circle className="donut-chart-bg" cx="50" cy="50" r="45" /><circle className={`donut-chart-fg ${status}`} cx="50" cy="50" r="45" strokeDasharray={circumference} strokeDashoffset={Math.max(0, offset)} /></svg>;
		}

		const CourseItem = ({ course, onSelect, onDelete, onQuickAdd, style, semesterWeeks, lastUpdatedId }) => {
			const [isUpdated, setIsUpdated] = useState(false);
			useEffect(() => { if (lastUpdatedId === course.id) { setIsUpdated(true); const timer = setTimeout(() => setIsUpdated(false), 1500); return () => clearTimeout(timer); } }, [lastUpdatedId, course.id]);
			
			const { name: status, remaining } = getCourseStatus(course, semesterWeeks);
            const total = semesterWeeks * course.lectureHours;
			const denial = Math.floor(total * CONSTANTS.DENIAL_PERCENTAGE) + 1;
			
			return (
				<div className={`course-item ${status} ${isUpdated ? "updated" : ""}`} style={style}>
					<div className="course-info"><h3>{course.name}</h3><p>ساعات الغياب: {course.absenceHours} | المتبقي للحرمان: {formatHoursText(remaining)}</p></div>
                    <div className="course-actions"><button onClick={() => onSelect(course)} title="تعديل"><Icons.Edit2 /></button><button onClick={() => onDelete(course.id)} title="حذف"><Icons.Trash /></button></div>
					<div className="course-progress"><div className="course-progress-bar" style={{ width: `${Math.min(100, (course.absenceHours / denial) * 100)}%` }}></div></div>
					<div className="course-meta">
                        <span>{formatRelativeTime(course.lastUpdated)}</span>
                        <div className="quick-add-controls">
                            <button className="quick-add-btn" onClick={() => onQuickAdd(course.id, 1)}>+1</button>
                            <button className="quick-add-btn" onClick={() => onQuickAdd(course.id, 2)}>+2</button>
                            <button className="quick-add-btn" onClick={() => onQuickAdd(course.id, 3)}>+3</button>
                        </div>
                    </div>
				</div>
			);
		};

		function CourseList({ courses, onSelect, onDelete, onQuickAdd, sortOrder, onSortChange, semesterWeeks, lastUpdatedId }) {
			return (
				<div id="course-list-section" className="card" style={{ animationDelay: '.2s' }}>
					<div className="card-header"><h2><Icons.ClipboardList /> قائمة المواد</h2>
						<div className="list-controls">
							<div className="control-btn">
								<Icons.Sort className="sort-icon" />
								<select value={sortOrder} onChange={e => onSortChange(e.target.value)} title="فرز المواد">
                                    <option value="urgency">الأكثر حرجًا</option>
                                    <option value="remaining">الأقل تبقيًا</option>
                                    <option value="recent">الأحدث تحديثًا</option>
                                    <option value="alpha">أبجدي</option>
                                </select>
							</div>
						</div>
					</div>
					{courses.length === 0 ? <div className="empty-list-message"><Icons.ClipboardList /><p>قائمتك فارغة. ابدأ بإضافة مادة جديدة!</p></div> : <div className="course-list">{courses.map((course, index) => <CourseItem key={course.id} course={course} onSelect={onSelect} onDelete={onDelete} onQuickAdd={onQuickAdd} semesterWeeks={semesterWeeks} lastUpdatedId={lastUpdatedId} style={{ animationDelay: `${index * 100}ms` }} />)}</div>}
				</div>
			);
		}
		
        const CollapsibleSection = ({ title, children, isVisible, onToggle }) => (
            <div className="collapsible-section">
                <div className="collapsible-header" onClick={onToggle}>
                    <h3 className="collapsible-title">{title}</h3>
                    <button type="button" className={`collapsible-toggle-btn ${isVisible ? 'expanded' : ''}`}><Icons.ChevronLeft /></button>
                </div>
                <div className={`collapsible-content ${isVisible ? 'visible' : ''}`}><div>{children}</div></div>
            </div>
        );

		function AbsenceCalculator({ onSave, selectedCourse, onClear, courses, semesterWeeks, setSemesterWeeks, showWeeksControl, onToggleWeeksControl }) {
			const [name, setName] = useState(selectedCourse?.name || "");
			const [lectureHours, setLectureHours] = useState(selectedCourse?.lectureHours || 3);
			const [absenceHours, setAbsenceHours] = useState(selectedCourse?.absenceHours ?? "");
			const [isEngineering, setIsEngineering] = useState(selectedCourse?.isEngineering || false);
			
			const result = useMemo(() => {
				const absenceNum = parseInt(absenceHours, 10) || 0;
				const total = semesterWeeks * lectureHours;
				const allowed = Math.floor(total * CONSTANTS.DENIAL_PERCENTAGE);
				const denial = allowed + 1;
				const percentage = total > 0 ? (absenceNum / total) * 100 : 0;
				const remaining = denial - absenceNum;

				const { name: status, isDenied } = getCourseStatus({ absenceHours: absenceNum, lectureHours }, semesterWeeks);
				
				let predictiveText = "";
				if (!isDenied) {
					if (remaining === 1) predictiveText = "تحذير: غياب ساعة واحدة يؤدي إلى الحرمان!";
					else if (remaining > 1) predictiveText = `أنت على بعد ${formatHoursText(remaining)} من الحرمان.`;
					else predictiveText = "أنت في منطقة الأمان.";
				}
				
				const bonusIsActive = isEngineering && percentage <= 5 && absenceHours !== "";
				let bonusTitle = "", bonusSubtitle = "";
				if (bonusIsActive) {
					const maxAbsenceForBonus = Math.floor(total * 0.05);
					const bonusHoursLeft = maxAbsenceForBonus - absenceNum;
					bonusTitle = "أداء ممتاز! بونص مستحق";
					bonusSubtitle = `نسبة غيابك المنخفضة تؤهلك لدرجتين. باقي لك ${formatHoursText(bonusHoursLeft)} قبل خسارة البونص.`;
				}
				return { percentage, status, predictiveText, allowed, denial, bonusTitle, bonusSubtitle, bonusIsActive, isDenied };
			}, [lectureHours, absenceHours, isEngineering, semesterWeeks]);

			const handleSubmit = (e) => {
				e.preventDefault();
				if (!name) return;

				const existingCourse = courses.find(c => c.name.trim().toLowerCase() === name.trim().toLowerCase());
				if (existingCourse && (!selectedCourse || selectedCourse.id !== existingCourse.id)) {
					Swal.fire({
						icon: 'warning', title: 'المادة موجودة بالفعل', text: `هل تريد تعديل بيانات مادة "${existingCourse.name}"؟`,
						showCancelButton: true, confirmButtonText: 'نعم، قم بالتعديل', cancelButtonText: 'إلغاء',
					}).then((result) => { if (result.isConfirmed) onClear(existingCourse); });
					return;
				}

				const isUpdating = !!selectedCourse;
				onSave({
					id: selectedCourse ? selectedCourse.id : Date.now(), name, lectureHours,
					absenceHours: parseInt(absenceHours, 10) || 0, isEngineering, lastUpdated: Date.now()
				});
                Toast.fire({ icon: 'success', title: isUpdating ? 'تم تحديث المادة بنجاح' : 'تمت إضافة المادة بنجاح' });
			};

			const changeAbsence = (change) => setAbsenceHours(String(Math.max(0, (parseInt(absenceHours, 10) || 0) + change)));
			
			return (
				<form className={`card ${result?.status}`} onSubmit={handleSubmit}>
					<div className="card-header">
                        <h2>{selectedCourse ? <><Icons.Edit2 /> تعديل المادة</> : <><Icons.Plus /> إضافة مادة جديدة</>}</h2>
                        {selectedCourse && <button type="button" className="clear-button" onClick={() => onClear(null)} title="إلغاء التعديل"><Icons.Plus /></button>}
                    </div>
					<div className="input-grid">
						<div className="input-group"><label>اسم المادة</label><input type="text" value={name} onChange={e => setName(e.target.value)} placeholder="مثال: فيزياء 101" required /></div>
						<div className="input-group">
							<div className="label-with-info">
								<label htmlFor="lecture-hours">الساعات الأسبوعية</label>
								<div className="info-tooltip-wrapper"><Icons.Lightbulb /><span className="info-tooltip">هي الساعات الفعلية التي تحضرها أسبوعيًا لهذه المادة، وليس عدد الساعات المعتمدة في الخطة الدراسية.</span></div>
							</div>
							<div className="select-wrapper"><select id="lecture-hours" value={lectureHours} onChange={e => setLectureHours(Number(e.target.value))}>{[...Array(12).keys()].map(i => <option key={i + 1} value={i + 1}>{formatHoursText(i + 1)}</option>)}</select></div>
						</div>
						<div className="input-group"><label>ساعات الغياب الحالية</label>
							<div className="absence-control">
								<button type="button" onClick={() => changeAbsence(1)}><Icons.ChevronRight /></button>
								<input type="number" value={absenceHours} onChange={e => setAbsenceHours(String(e.target.value))} placeholder="0" min="0" />
								<button type="button" onClick={() => changeAbsence(-1)}><Icons.ChevronLeft /></button>
							</div>
						</div>
					</div>
					<div className="bonus-toggle-container">
						<label className="toggle-label-wrapper">
							<input type="checkbox" checked={isEngineering} onChange={e => setIsEngineering(e.target.checked)} />
							<span className="toggle-switch"></span><span className="toggle-text">مادة من كلية الهندسة</span>
							<div className="info-tooltip-wrapper"><Icons.Lightbulb /><span className="info-tooltip">تفعيل هذا الخيار يوضح لك ما إذا كنت مؤهلاً للحصول على بونص الدرجتين بناءً على نسبة غيابك.</span></div>
						</label>
					</div>

                    <div className="divider"></div>
                    <CollapsibleSection title={<><Icons.Sliders /> إعدادات الفصل</>} isVisible={showWeeksControl} onToggle={onToggleWeeksControl}>
                        <div className="settings-container">
                            <div className="settings-item">
                                <h3>عدد أسابيع الفصل</h3>
                                <div className="stepper-control">
                                    <button type="button" onClick={() => setSemesterWeeks(p => Math.min(CONSTANTS.MAX_WEEKS, p + 1))} disabled={semesterWeeks >= CONSTANTS.MAX_WEEKS}><Icons.ChevronRight /></button>
                                    <span className="stepper-value">{semesterWeeks}</span>
                                    <button type="button" onClick={() => setSemesterWeeks(p => Math.max(CONSTANTS.MIN_WEEKS, p - 1))} disabled={semesterWeeks <= CONSTANTS.MIN_WEEKS}><Icons.ChevronLeft /></button>
                                </div>
                            </div>
                        </div>
                    </CollapsibleSection>
					
					{result && absenceHours !== "" && (<>
						<div className="divider"></div>
						<div className="result-section">
							<div className="chart-container"><DonutChart percentage={result.percentage} status={result.status} /><div className="chart-info"><span>{Math.min(result.percentage, 100).toFixed(1)}%</span><p>نسبة الغياب</p></div></div>
							<div className="result-details">
								<div className="detail-item"><span>الغياب المسموح</span><strong>{formatHoursText(result.allowed)}</strong></div>
								<div className="detail-item"><span>بداية الحرمان</span><strong>{formatHoursText(result.denial)}</strong></div>
								{result.isDenied ? (
									<div className="denial-message"><Icons.AlertTriangle className="denial-icon" /><div className="denial-text-content"><p className="denial-title">حرمان</p><p className="denial-subtitle">لقد تجاوزت الحد الأقصى للغياب.</p></div></div>
								) : (<p className="predictive-text">{result.predictiveText}</p>)}
								{result.bonusIsActive && <div className="bonus-box"><Icons.Shield className="bonus-icon" /><div className="bonus-text-content"><p className="bonus-title">{result.bonusTitle}</p><p className="bonus-subtitle">{result.bonusSubtitle}</p></div></div>}
							</div>
						</div>
					</>)}
					<button type="submit" className="save-button" disabled={!name}>{selectedCourse ? <><Icons.Save /> تحديث المادة</> : <><Icons.Save /> إضافة المادة</>}</button>
				</form>
			);
		}
		
		function App() {
			const [courses, setCourses] = useLocalStorage("courses", []);
			const [selectedCourse, setSelectedCourse] = useState(null);
			const [sortOrder, setSortOrder] = useState('urgency');
			const [theme, setTheme] = useLocalStorage('theme', PRESET_THEMES.blue);
			const [semesterWeeks, setSemesterWeeks] = useLocalStorage('semesterWeeks', 17);
			const [lastUpdatedId, setLastUpdatedId] = useState(null);
            const [showWeeksControl, setShowWeeksControl] = useLocalStorage('showWeeksControl', false);
			
			useEffect(() => {
                const primaryColor = theme;
                const darkColor = adjustColorBrightness(primaryColor, -20);
                const rgbColor = hexToRgb(primaryColor);
                
                document.documentElement.style.setProperty('--color-primary', primaryColor);
                document.documentElement.style.setProperty('--color-primary-dark', darkColor);
                if (rgbColor) {
                    document.documentElement.style.setProperty('--rgb-primary', rgbColor);
                }
			}, [theme]);

			useEffect(() => {
				if ('serviceWorker' in navigator) {
					const swCode = `
						const CACHE_NAME = 'absence-calculator-cache-v6';
						self.addEventListener('install', e => e.waitUntil(caches.open(CACHE_NAME).then(c => c.add('.'))));
						self.addEventListener('fetch', e => e.respondWith(caches.match(e.request).then(r => r || fetch(e.request))));`;
					try { const blob = new Blob([swCode], { type: 'application/javascript' }); navigator.serviceWorker.register(URL.createObjectURL(blob)); } 
                    catch(e) { console.error("Could not register service worker.", e); }
				}
			}, []);

			const handleAddOrUpdate = (course) => {
				const index = courses.findIndex(c => c.id === course.id);
				const updatedCourses = [...courses];
				if (index > -1) { updatedCourses[index] = course; } 
                else { updatedCourses.push(course); }
				setCourses(updatedCourses); setLastUpdatedId(course.id); setSelectedCourse(null);
			};

            const handleQuickAdd = useCallback((id, amount) => {
                const updatedCourses = courses.map(c => c.id === id ? { ...c, absenceHours: c.absenceHours + amount, lastUpdated: Date.now() } : c);
                setCourses(updatedCourses); setLastUpdatedId(id);
                const course = updatedCourses.find(c => c.id === id);
                Toast.fire({ icon: 'success', title: `تم تحديث غياب ${course.name}` });
            }, [courses, setCourses]);

			const handleDelete = (id) => {
				Swal.fire({
					title: 'هل أنت متأكد؟', text: "لن تتمكن من استرجاع هذه المادة!", icon: 'warning', showCancelButton: true, 
                    confirmButtonColor: 'var(--color-primary)', cancelButtonColor: 'var(--color-danger-red)',
					confirmButtonText: 'نعم، احذفها!', cancelButtonText: 'إلغاء'
				}).then((result) => {
					if (result.isConfirmed) {
						setCourses(courses.filter(c => c.id !== id)); 
						if (selectedCourse && selectedCourse.id === id) setSelectedCourse(null);
                        Toast.fire({ icon: 'success', title: 'تم حذف المادة' });
					}
				})
			};

            const handleResetAll = () => {
				Swal.fire({
					title: 'إعادة تعيين بيانات الفصل؟', text: "سيتم حذف جميع المواد المحفوظة. هذا الإجراء لا يمكن التراجع عنه.", icon: 'error',
					showCancelButton: true, confirmButtonColor: 'var(--color-danger-red)', cancelButtonColor: 'var(--color-border)',
					confirmButtonText: 'نعم، حذف الكل!', cancelButtonText: 'إلغاء'
				}).then((result) => {
					if (result.isConfirmed) {
						setCourses([]); setSelectedCourse(null);
                        Toast.fire({ icon: 'success', title: 'تم مسح جميع البيانات' });
					}
				})
            };

			const handleSelect = (course) => { setSelectedCourse(course); window.scrollTo({ top: 0, behavior: "smooth" }); };
			const handleClear = (courseToSelect = null) => { setSelectedCourse(courseToSelect); if(courseToSelect) { window.scrollTo({ top: 0, behavior: "smooth" }); } };
			
			const sortedCourses = useMemo(() => {
				return [...courses].sort((a, b) => {
                    const statusA = getCourseStatus(a, semesterWeeks);
                    const statusB = getCourseStatus(b, semesterWeeks);
                    switch (sortOrder) {
                        case 'recent': return b.lastUpdated - a.lastUpdated;
                        case 'alpha': return a.name.localeCompare(b.name, 'ar');
                        case 'remaining': return statusA.remaining - statusB.remaining;
                        case 'urgency': default:
                            const totalA = semesterWeeks * a.lectureHours, totalB = semesterWeeks * b.lectureHours;
                            const percentageA = totalA > 0 ? (a.absenceHours / totalA) : 0;
                            const percentageB = totalB > 0 ? (b.absenceHours / totalB) : 0;
                            return percentageB - percentageA;
                    }
                });
			}, [courses, sortOrder, semesterWeeks]);

            const isCustomTheme = !Object.values(PRESET_THEMES).includes(theme);

			return (
				<div className="app">
					<div className="aurora-bg"><div className="aurora-dot aurora-dot-1"></div><div className="aurora-dot aurora-dot-2"></div></div>
					<div className="container">
						<header className="header">
							<h1 className="title">حاسبة الغياب</h1>
							<p className="subtitle">تابع غيابك الدراسي بكل أناقة وسهولة</p>
						</header>
						<AbsenceCalculator 
							key={selectedCourse ? selectedCourse.id : "new"} 
							onSave={handleAddOrUpdate} selectedCourse={selectedCourse} onClear={handleClear} courses={courses}
                            semesterWeeks={semesterWeeks} setSemesterWeeks={setSemesterWeeks}
                            showWeeksControl={showWeeksControl} onToggleWeeksControl={() => setShowWeeksControl(!showWeeksControl)}
						/>
						{courses.length > 0 && <CourseList courses={sortedCourses} onSelect={handleSelect} onDelete={handleDelete} onQuickAdd={handleQuickAdd} sortOrder={sortOrder} onSortChange={setSortOrder} semesterWeeks={semesterWeeks} lastUpdatedId={lastUpdatedId} />}
						<footer className="footer">
							<span className="footer-link">© 2025 | ظلام</span>
							<div className="footer-controls">
								<button onClick={handleResetAll} className="reset-all-btn" title="إعادة تعيين بيانات الفصل"><Icons.Restart /></button>
								<div className="theme-picker" title="اختر السمة">
                                    {Object.entries(PRESET_THEMES).map(([name, color]) => (
                                        <div key={name} className={`theme-dot ${theme === color ? 'active' : ''}`} style={{ backgroundColor: color }} onClick={() => setTheme(color)} />
                                    ))}
                                    <label htmlFor="custom-color-picker" className={`color-picker-label ${isCustomTheme ? 'active' : ''}`} title="اختر لونًا مخصصًا">
                                        <Icons.PaintPaletteEmoji />
                                    </label>
                                    <input id="custom-color-picker" type="color" className="color-picker-input" value={theme} onChange={(e) => setTheme(e.target.value)} />
                                </div>
								<a href="https://t.me/zalam_0" className="footer-link" target="_blank" rel="noopener noreferrer" title="تواصل معي على تليجرام"><Icons.Telegram /></a>
							</div>
						</footer>
					</div>
				</div>
			);
		}
		
		const root = ReactDOM.createRoot(document.getElementById("root"));
		root.render(<StrictMode><App /></StrictMode>);
	</script>
</body>
</html>